slam_toolbox:
  ros__parameters:

    # 后端优化器配置 (Plugin params)
    # 选择Ceres Solver作为优化后端，并配置其核心参数
    solver_plugin: solver_plugins::CeresSolver
    ceres_linear_solver: SPARSE_NORMAL_CHOLESKY  # 线性求解器类型（稀疏正态乔列斯基分解）
    ceres_preconditioner: SCHUR_JACOBI           # 预处理器类型（舒尔雅克比）
    ceres_trust_strategy: LEVENBERG_MARQUARDT    # 信任域策略（列文伯格-马夸尔特法）
    ceres_dogleg_type: TRADITIONAL_DOGLEG        # 狗腿法类型（传统狗腿法）
    ceres_loss_function: None                    # 损失函数（无，使用普通最小二乘）

    # ROS核心参数 (ROS Parameters)
    # 坐标系、数据话题及运行模式配置
    odom_frame: odom    # 里程计坐标系
    map_frame: map               # 地图坐标系
    base_frame: base_link   # 机器人基坐标系
    scan_topic: /scan            # 激光雷达数据话题
    use_map_saver: true          # 是否启用地图保存功能
    mode: mapping #localization  # 运行模式（mapping建图 / localization定位）

    # 地图初始位姿配置（可选）
    # 若需要从指定位姿或充电桩开始建图，取消对应注释（二者互斥，优先使用map_start_pose）
    #map_file_name: test_steve    # 地图文件名
    # map_start_pose: [0.0, 0.0, 0.0]  # 初始位姿 [x, y, yaw]
    #map_start_at_dock: true      # 是否从充电桩位置开始

    debug_logging: false                 # 是否启用调试日志
    throttle_scans: 1                    # 激光数据降采样率（1表示不降采样）
    transform_publish_period: 0.02       # TF变换发布周期（秒，0表示不发布）
    map_update_interval: 0.5             # 地图更新间隔（秒）
    resolution: 0.05                     # 地图分辨率（米/像素）
    restamp_tf: false                    # 是否重新戳记TF时间戳
    min_laser_range: 0.3 #for rastering images  # 激光数据最小有效距离（用于地图栅格化）
    max_laser_range: 20.0 #for rastering images # 激光数据最大有效距离（用于地图栅格化）
    minimum_time_interval: 0.5           # 两次地图更新的最小时间间隔（秒）
    transform_timeout: 0.2               # TF变换超时时间（秒）
    tf_buffer_duration: 30.0             # TF缓存时长（秒）
    stack_size_to_use: 40000000          # 栈大小（用于序列化大型地图，需足够大）
    enable_interactive_mode: true        # 是否启用交互模式（支持rviz手动校正）

    # 通用建图参数 (General Parameters)
    # 控制扫描匹配、闭环检测等核心建图逻辑
    use_scan_matching: true              # 是否启用扫描匹配
    use_scan_barycenter: true            # 是否使用扫描重心优化匹配
    minimum_travel_distance: 0.01         # 触发扫描匹配的最小移动距离（米）
    minimum_travel_heading: 0.01          # 触发扫描匹配的最小旋转角度（弧度）
    scan_buffer_size: 10                 # 扫描缓存队列大小
    scan_buffer_maximum_scan_distance: 10.0 # 缓存中扫描点的最大距离（米）
    link_match_minimum_response_fine: 0.1  # 精细匹配的最小响应阈值
    link_scan_maximum_distance: 1.5      # 关联扫描的最大距离（米）
    loop_search_maximum_distance: 3.0    # 闭环搜索的最大距离（米）
    do_loop_closing: true                # 是否启用闭环检测
    loop_match_minimum_chain_size: 10    # 闭环检测所需的最小关键帧链长度
    loop_match_maximum_variance_coarse: 3.0 # 粗匹配的最大方差阈值
    loop_match_minimum_response_coarse: 0.35 # 粗匹配的最小响应阈值
    loop_match_minimum_response_fine: 0.45  # 精细匹配的最小响应阈值

    # 相关性参数 - 扫描匹配 (Correlation Parameters)
    # 配置扫描匹配的搜索空间和分辨率
    correlation_search_space_dimension: 0.5  # 匹配搜索空间维度（米）
    correlation_search_space_resolution: 0.01 # 搜索空间分辨率（米）
    correlation_search_space_smear_deviation: 0.1 # 搜索空间模糊偏差

    # 相关性参数 - 闭环检测 (Loop Closure Parameters)
    # 配置闭环检测的搜索空间和分辨率
    loop_search_space_dimension: 8.0     # 闭环搜索空间维度（米）
    loop_search_space_resolution: 0.05   # 闭环搜索空间分辨率（米）
    loop_search_space_smear_deviation: 0.03 # 闭环搜索空间模糊偏差

    # 扫描匹配器参数 (Scan Matcher Parameters)
    # 配置匹配惩罚和搜索角度
    distance_variance_penalty: 0.5       # 距离方差惩罚权重
    angle_variance_penalty: 1.0          # 角度方差惩罚权重
    fine_search_angle_offset: 0.00349    # 精细搜索角度偏移（弧度，约0.2°）
    coarse_search_angle_offset: 0.349    # 粗搜索角度偏移（弧度，约20°）
    coarse_angle_resolution: 0.0349      # 粗搜索角度分辨率（弧度，约2°）
    minimum_angle_penalty: 0.9           # 最小角度惩罚系数
    minimum_distance_penalty: 0.5        # 最小距离惩罚系数
    use_response_expansion: true         # 是否使用响应扩展
    min_pass_through: 2                  # 最小通过次数
    occupancy_threshold: 0.1             # 占据栅格阈值（0~1，高于此值视为障碍物）
